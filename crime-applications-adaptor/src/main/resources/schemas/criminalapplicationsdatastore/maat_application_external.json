{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "$id": "ministryofjustice/laa-criminal-legal-aid-schemas/main/schemas/1.0/maat_application.json",
  "title": "An application for criminal legal aid for MAAT",
  "description": "Attributes of a criminal legal aid application for MAAT",
  "type": "object",
  "properties": {
    "id": { "type": "string" },
    "schema_version": { "type": "number" },
    "reference": { "type": "integer" },
    "application_type": { "type": "string", "enum": ["initial", "post_submission_evidence", "change_in_financial_circumstances"] },
    "submitted_at": { "type": "string", "format": "date-time", "customDateTimePattern": "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'" },
    "declaration_signed_at": { "type": "string", "format": "date-time", "customDateTimePattern": "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'" },
    "date_stamp": { "type": "string", "format": "date-time", "customDateTimePattern": "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'" },
    "ioj_bypass": {
      "description": "Indicates whether the Interests of Justice page was skipped or not",
      "type": "boolean"
    },
    "means_passport": {
      "type": "array",
      "items": { "type": "string", "enum": ["on_age_under18", "on_benefit_check"] }
    },
    "provider_details": {
      "$ref": "#/definitions/provider"
    },
    "client_details": {
      "type": "object",
      "properties": {
        "applicant": {
          "type": "object",
          "properties": {
            "first_name": { "type": "string" },
            "last_name": { "type": "string" },
            "other_names": { "type": ["string", "null"] },
            "date_of_birth": { "type": "string", "format": "date" },
            "nino": { "type": ["string", "null"] },
            "benefit_type": { "type": ["string", "null"], "enum": ["universal_credit", "guarantee_pension", "jsa", "esa", "income_support", null] },
            "telephone_number": { "type": ["string", "null"] },
            "correspondence_address_type": { "type": "string", "enum": ["other_address", "home_address", "providers_office_address"] },
            "home_address": { "$ref": "#/definitions/address" },
            "correspondence_address": { "$ref": "#/definitions/address" }
          },
          "required": ["first_name", "last_name", "date_of_birth", "correspondence_address_type"]
        }
      },
      "required": ["applicant"]
    },
    "case_details": {
      "type": "object",
      "properties": {
        "urn": { "type": ["string", "null"] },
        "case_type": {
          "type": "string",
          "enum": [
            "summary_only",
            "either_way",
            "indictable",
            "already_in_crown_court",
            "committal",
            "appeal_to_crown_court",
            "appeal_to_crown_court_with_changes"
          ]
        },
        "appeal_maat_id": { "type": ["string", "null"] },
        "appeal_lodged_date": { "type": ["string", "null"], "format": "date" },
        "appeal_with_changes_details": { "type": ["string", "null"] },
        "offence_class": { "type": ["string", "null"], "enum": ["A", "K", "G", "B", "I", "J", "D", "C", "H", "F", "E", null] },
        "hearing_court_name": { "type": "string" },
        "hearing_date": { "type": "string", "format": "date" }
      },
      "required": ["case_type", "hearing_court_name", "hearing_date", "offence_class"]
    },
    "means_details": {
      "type": "object",
      "properties": {
        "income_details": {
          "type": "object",
          "properties": {
            "benefits": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": [
                      "child",
                      "working_or_child_tax_credit",
                      "universal_credit",
                      "incapacity",
                      "industrial_injuries_disablement",
                      "jsa",
                      "other"
                    ]
                  },
                  "amount": {
                    "type": "integer"
                  },
                  "frequency": {
                    "type": "string",
                    "enum": ["week", "fortnight", "four_weeks", "month", "annual"]
                  },
                  "details": {
                    "anyOf": [
                      {
                        "type": "null"
                      },
                      {
                        "type": "string"
                      }
                    ]
                  }
                },
                "required": ["type", "amount", "frequency"]
              }
            },
            "employment_type": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["employed", "self-employed", "business_partnership", "director", "shareholder", "not_working"]
              }
            },
            "employment_details": {
              "type": "object",
              "properties": {
                "paye": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "amount": {
                        "type": "integer"
                      },
                      "date": {
                        "type": "string",
                        "format": "date"
                      },
                      "deductions": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "type": {
                              "type": "string"
                            },
                            "amount": {
                              "type": "integer"
                            }
                          },
                          "required": ["type", "amount"]
                        }
                      }
                    },
                    "required": ["amount", "date", "deductions"]
                  }
                },
                "other": {
                  "type": "object",
                  "properties": {
                    "amount": {
                      "type": "integer"
                    },
                    "details": {
                      "type": "string"
                    }
                  },
                  "required": ["amount", "details"]
                },
                "businesses": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "name": {
                        "type": "string"
                      },
                      "address": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "lookup_id": {
                              "anyOf": [
                                {
                                  "type": "null"
                                },
                                {
                                  "type": "string"
                                }
                              ]
                            },
                            "address_line_one": {
                              "type": "string"
                            },
                            "address_line_two": {
                              "anyOf": [
                                {
                                  "type": "null"
                                },
                                {
                                  "type": "string"
                                }
                              ]
                            },
                            "city": {
                              "type": "string"
                            },
                            "country": {
                              "type": "string"
                            },
                            "postcode": {
                              "type": "string"
                            }
                          },
                          "required": ["lookup_id", "address_line_one", "address_line_two", "city", "country", "postcode"]
                        }
                      },
                      "last_two_years_tax_liability": {
                        "type": "integer"
                      },
                      "total_turnover": {
                        "type": "integer"
                      },
                      "total_drawing": {
                        "type": "integer"
                      },
                      "total_profit": {
                        "type": "integer"
                      },
                      "director_salary": {
                        "type": "integer"
                      },
                      "share": {
                        "type": "number"
                      }
                    },
                    "required": [
                      "name",
                      "address",
                      "last_two_years_tax_liability",
                      "total_turnover",
                      "total_drawing",
                      "total_profit",
                      "director_salary",
                      "share"
                    ]
                  }
                }
              },
              "required": ["paye"]
            },
            "other_income": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": [
                      "private_pension",
                      "state_pension",
                      "maintenance",
                      "interest",
                      "student",
                      "board_from_family",
                      "rent",
                      "friends_and_family",
                      "other"
                    ]
                  },
                  "amount": {
                    "type": "integer"
                  },
                  "frequency": {
                    "type": "string",
                    "enum": ["week", "fortnight", "four_weeks", "month", "annual"]
                  },
                  "details": {
                    "anyOf": [
                      {
                        "type": "null"
                      },
                      {
                        "type": "string"
                      }
                    ]
                  }
                },
                "required": ["type", "amount", "frequency"]
              }
            },
            "total": {
              "type": "integer"
            },
            "dependants": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "age": {
                    "type": "integer",
                    "exclusiveMaximum": 18
                  }
                },
                "required": ["age"]
              }
            }
          },
          "required": []
        },
        "outgoings_details": {
          "type": "object",
          "properties": {
            "outgoings": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": ["housing", "council_tax", "childcare", "maintenance", "legal_aid"]
                  },
                  "amount": {
                    "type": "integer"
                  },
                  "frequency": {
                    "type": "string",
                    "enum": ["week", "fortnight", "four_weeks", "month", "annual"]
                  },
                  "details": {
                    "anyOf": [
                      {
                        "type": "null"
                      },
                      {
                        "type": "string"
                      }
                    ]
                  }
                },
                "required": ["type", "amount", "frequency"]
              }
            },
            "housing_payment_type": {
              "anyOf": [
                {
                  "type": "null"
                },
                {
                  "type": "string",
                  "enum": ["rent", "mortgage", "board_lodgings", "none"]
                }
              ]
            }
          },
          "required": []
        }
      }
    }
  },
  "required": [
    "id",
    "schema_version",
    "reference",
    "application_type",
    "submitted_at",
    "date_stamp",
    "declaration_signed_at",
    "ioj_bypass",
    "means_passport",
    "provider_details",
    "client_details",
    "case_details"
  ],
  "definitions": {
    "provider": { "$ref": "general/provider.json" },
    "address": { "$ref": "general/address.json" }
  }
}
